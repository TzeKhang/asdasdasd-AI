import pandas as pd

class RevenueRecommender:
    def __init__(self, file_path="RevenueMovies.csv"):
        self.df = pd.read_csv(file_path)
        if "title" not in self.df.columns or "revenue" not in self.df.columns:
            raise ValueError("Dataset must contain 'title' and 'revenue' columns.")
        
        self.df = self.df[['title', 'revenue']].dropna()
        self.df = self.df[self.df['revenue'] > 0].reset_index(drop=True)

    def recommend_by_revenue(self, selected_title, tolerance=0.3, top_n=5):
        if selected_title not in self.df['title'].values:
            return [], None

        selected_revenue = self.df.loc[self.df['title'] == selected_title, 'revenue'].values[0]
        lower_bound = selected_revenue * (1 - tolerance)
        upper_bound = selected_revenue * (1 + tolerance)

        recommendations = self.df[
            (self.df['revenue'] >= lower_bound) &
            (self.df['revenue'] <= upper_bound) &
            (self.df['title'] != selected_title)
        ]

        return recommendations.sample(min(top_n, len(recommendations))), selected_revenue

    def get_random_movies(self, n=20):
        return self.df.sample(min(n, len(self.df)))
